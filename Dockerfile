FROM ubuntu:24.10

###############################################################################
## Setup user =================================================================
###############################################################################
ARG USER=dev
ENV HOME=/home/$USER
RUN \
  apt-get update && apt-get install -y \
  sudo \
  adduser
RUN \
  useradd -m -d $HOME $USER \
  && passwd -d $USER \
  && adduser $USER sudo
###############################################################################

###############################################################################
## Copy binaries ==============================================================
###############################################################################
RUN mkdir -p ~/.local/bin
COPY bin ~/.local/bin
###############################################################################

###############################################################################
## Install programs ===========================================================
###############################################################################
COPY init_scripts $HOME/init_scripts
COPY init.sh $HOME/init.sh
RUN $HOME/init.sh && rm -rf $HOME/init_scripts && rm $HOME/init.sh
###############################################################################

###############################################################################
# Complete user setup #########################################################
###############################################################################
USER $USER
RUN sudo chown -Rc $USER:$USER $HOME
RUN chsh -s /bin/zsh
WORKDIR $HOME/host
###############################################################################

ENTRYPOINT ["tmux", "-u"]
